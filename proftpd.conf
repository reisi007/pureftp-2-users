# /etc/proftpd/proftpd.conf

ServerName          "ProFTPD Server"
ServerType          standalone
DefaultServer       on
Port                21
Umask               022
MaxInstances        200

# Use the file-based auth (Virtual Users)
AuthOrder           mod_auth_file.c
AuthUserFile        /etc/proftpd/ftpd.passwd
# Disable shell requirement so /bin/false works
RequireValidShell   off
# Lock users to their home directory
DefaultRoot         ~

# --- Logging ---
SystemLog           /dev/stdout
TransferLog         /dev/stdout

# --- Network / Passive Mode ---
# These match the ports exposed in Docker
PassivePorts        30000 30500
# Placeholder replaced by entrypoint.sh
MasqueradeAddress   __EXTERNAL_IP__

# --- TLS Configuration ---
<IfModule mod_tls.c>
    TLSEngine                   on
    TLSLog                      /dev/stdout
    TLSProtocol                 TLSv1.2 TLSv1.3
    
    # Enforce TLS for both control and data (Equivalent to Pure-FTPd -Y 2)
    TLSRequired                 on
    
    # Certificates (Generated in entrypoint)
    TLSRSACertificateFile       /etc/ssl/private/pure-ftpd.pem
    TLSRSACertificateKeyFile    /etc/ssl/private/pure-ftpd.pem
    
    # Relax verification (optional, often helps with some clients)
    TLSVerifyClient             off
    TLSOptions                  NoSessionReuseRequired
</IfModule>